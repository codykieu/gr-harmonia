id: harmonia_frequency_pk_est
label: Frequency Peak Estimation
category: '[harmonia]'

parameters:
- id: nfft
  label: FFT Ratio
  dtype: int
  default: "1024"
- id: pulse_width
  label: Pulse Width
  dtype: float
  default: "200e-6"
- id: cap_length
  label: Capture Length
  dtype: float
  default: "400e-6"
- id: samp_rate
  label: Sample Rate
  dtype: float
  default: "samp_rate"
- id: NLLS_iter
  label: NLLS Iterations
  dtype: float
  default: "15"
- id: NLLS_pts
  label: NLLS Points
  dtype: float
  default: "7"
- id: backend
  label: Backend
  dtype: enum
  options: [harmonia.Device.DEFAULT, harmonia.Device.CPU, harmonia.Device.CUDA, harmonia.Device.OPENCL]
  option_labels: [Default, CPU, Cuda, OpenCL]
- id: depth
  label: Message queue depth
  dtype: int
  default: 1
  hide: part
- id: enable_out
  label: Enable "out" Message Port
  dtype: bool
  options: [True, False]
  option_labels: ['Enabled', 'Disabled']
  default: True
# Metadata keys
- id: current_sdr
  label: Processing SDR
  dtype: string
  default: 'PMT_HARMONIA_SDR1'
  hide: part
  category: Metadata

inputs:
-   domain: message
    id: in

outputs:
-   domain: message
    id: out
    hide: ${ not enable_out }
-   domain: message
    id: f_out

templates:
  imports: from gnuradio import harmonia
  make: |-
    harmonia.frequency_pk_est(${nfft}, ${pulse_width}, ${cap_length}, ${samp_rate}, ${NLLS_iter}, ${NLLS_pts}, ${enable_out})
    self.${id}.set_msg_queue_depth(${depth})
    self.${id}.set_backend(${backend})
    self.${id}.init_metadata_keys()

#  'file_format' specifies the version of the GRC yml format used in the file
#  and should usually not be changed.
file_format: 1
